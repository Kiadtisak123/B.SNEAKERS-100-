<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>สินค้าทั้งหมด | B.Sneakers</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
  * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Kanit', sans-serif; }
  body { background: #0f0f0f; color: #fff; }

  /* ===== HEADER ===== */
  header {
    background: #111; padding: 15px 30px; display: flex;
    justify-content: space-between; align-items: center;
    border-bottom: 2px solid #e60023; position: sticky; top: 0; z-index: 1000;
  }
  .logo { font-size: 24px; font-weight: bold; color: #e60023; letter-spacing: 1px; text-decoration: none; }
  .logo span { color: #fff; }
  
  nav { display: flex; gap: 20px; align-items: center; }
  nav a { color: #fff; text-decoration: none; font-size: 15px; transition: 0.3s; }
  nav a:hover { color: #e60023; }

  /* Dropdown ปรับปรุงให้รองรับหมวดหมู่ใหม่ */
  .dropdown { position: relative; display: inline-block; }
  .dropdown-menu {
    position: absolute; top: 100%; left: 0;
    background: #1a1a1a; border: 1px solid #333;
    border-radius: 12px; display: none; min-width: 200px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.5); padding: 10px 0;
    z-index: 1001;
  }
  .dropdown-menu a { display: block; padding: 10px 20px; color: #ccc; font-size: 14px; }
  .dropdown-menu a:hover { background: #e60023; color: #fff; }
  .dropdown:hover .dropdown-menu { display: block; }

  /* Cart Icon */
  .cart-link { position: relative; display: flex; align-items: center; gap: 8px; background: #222; padding: 8px 15px; border-radius: 20px; cursor: pointer;}
  .cart-count { background: #e60023; color: white; border-radius: 50%; padding: 2px 7px; font-size: 11px; position: absolute; top: -5px; right: -5px; border: 2px solid #111; }

  /* ===== CONTENT ===== */
  .container { max-width: 1200px; margin: auto; padding: 40px 20px; }
  h1 { margin-bottom: 30px; font-size: 28px; border-left: 5px solid #e60023; padding-left: 15px; }
  
  .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }

  .card {
    background: #1a1a1a; border-radius: 20px; overflow: hidden;
    border: 1px solid #222; transition: 0.4s;
    display: flex; flex-direction: column; cursor: pointer; position: relative;
  }
  .card:hover { transform: translateY(-10px); border-color: #e60023; box-shadow: 0 15px 30px rgba(0,0,0,0.5); }
  
  .img-box { position: relative; width: 100%; height: 250px; overflow: hidden; background: #000; }
  .card img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
  .card:hover img { transform: scale(1.05); }

  .card-body { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; }
  .card-body h3 { font-size: 18px; margin-bottom: 5px; color: #fff; height: 45px; overflow: hidden; }
  .price { color: #e60023; font-size: 22px; font-weight: bold; margin-bottom: 15px; }
  .size-tag { color: #888; font-size: 12px; margin-bottom: 10px; }

  .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .btn {
    padding: 12px; border: none; border-radius: 10px; cursor: pointer;
    font-weight: bold; transition: 0.3s; font-size: 13px;
    display: flex; align-items: center; justify-content: center; gap: 5px;
  }
  .btn-buy { background: #e60023; color: #fff; }
  .btn-cart { background: #333; color: #fff; }
  .btn-buy:hover { background: #ff1a3d; }
  .btn-cart:hover { background: #444; }

  .sold-out-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); color: white; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: bold; z-index: 2; pointer-events: none; }

  footer { background: #111; text-align: center; padding: 40px; border-top: 2px solid #e60023; margin-top: 60px; color: #666; }

  .messenger-float {
    position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px;
    background: #0084ff; color: white; font-size: 28px;
    display: flex; align-items: center; justify-content: center;
    border-radius: 50%; text-decoration: none;
    box-shadow: 0 10px 25px rgba(0,0,0,0.4); z-index: 999; transition: 0.3s;
  }
</style>
</head>

<body>

<header>
  <a href="Homepage.html" class="logo">B.<span>SNEAKERS</span></a>

  <nav>
    <a href="Homepage.html">หน้าแรก</a>

    <div class="dropdown">
      <a href="#" style="color: #e60023;">สินค้า <i class="fa-solid fa-chevron-down" style="font-size: 10px;"></i></a>
      <div class="dropdown-menu">
        <a href="product.html">สินค้าทั้งหมด</a>
        <a href="Air Force.html">Air Force</a>
        <a href="Air Jordan .html">Air Jordan 1 Low</a>
        <a href="Air Jordan 1 Mid.html">Air Jordan 1 Mid</a>
        <a href="Nike Dunk Low.html">Nike Dunk Low</a>
      </div>
    </div>

    <a href="contact.html">ติดต่อเรา</a>

    <div class="cart-link" onclick="location.href='ตระกร้า.html'">
      <i class="fa-solid fa-cart-shopping"></i>
      <span id="cartCount" class="cart-count">0</span>
    </div>
  </nav>
</header>

<div class="container">
  <h1>สินค้าทั้งหมด</h1>
  <div class="grid" id="productGrid">
      </div>
</div>

<footer>© 2026 B.Sneakers - Trusted Sneaker Shop</footer>

<a href="https://m.me/102799091274255" target="_blank" class="messenger-float">
  <i class="fa-brands fa-facebook-messenger"></i>
</a>

<script>
// --- 1. โหลดและแสดงสินค้าทั้งหมด (ไม่มีการ Filter) ---
function renderAllProducts() {
    const grid = document.getElementById("productGrid");
    const products = JSON.parse(localStorage.getItem('sneaker_prods')) || [];

    if (products.length === 0) {
        grid.innerHTML = `<div style="grid-column:1/-1; text-align:center; padding:50px; color:#666;">ยังไม่มีสินค้าในระบบ</div>`;
        return;
    }

    grid.innerHTML = products.map(p => {
        const isOutOfStock = Number(p.stock) <= 0;
        const displayImg = (p.images && p.images.length > 0) ? p.images[0] : (p.img || 'https://via.placeholder.com/400');
        
        return `
        <div class="card" onclick="viewDetail('${p.id}')">
            ${isOutOfStock ? '<div class="sold-out-overlay">OUT OF STOCK</div>' : ''}
            <div class="img-box">
                <img src="${displayImg}" onerror="this.src='https://via.placeholder.com/400'">
            </div>
            <div class="card-body">
                <h3>${p.name}</h3>
                <div class="size-tag">Size: ${p.sizes || 'N/A'}</div>
                <div class="price">฿${Number(p.price).toLocaleString()}</div>
                <div class="btn-group">
                    <button class="btn btn-buy" onclick="buyNow(event, '${p.id}')">ซื้อเลย</button>
                    <button class="btn btn-cart" onclick="addToCart(event, '${p.id}')">
                        <i class="fa-solid fa-cart-plus"></i>
                    </button>
                </div>
            </div>
        </div>`;
    }).join('');
}

// --- 2. ฟังก์ชันจัดการระบบร้านค้า ---
function viewDetail(id) {
    const products = JSON.parse(localStorage.getItem('sneaker_prods')) || [];
    const p = products.find(item => String(item.id) === String(id));
    if(p) {
        localStorage.setItem("selectedProduct", JSON.stringify(p));
        window.location.href = "detail.html";
    }
}

function buyNow(e, id) {
    e.stopPropagation();
    const products = JSON.parse(localStorage.getItem('sneaker_prods')) || [];
    const p = products.find(item => String(item.id) === String(id));
    
    if(p && Number(p.stock) > 0) {
        const checkoutItem = [{
            id: p.id,
            name: p.name,
            price: p.price,
            qty: 1,
            size: p.sizes ? p.sizes.split(',')[0].trim() : 'N/A',
            img: (p.images && p.images.length > 0) ? p.images[0] : p.img
        }];
        localStorage.setItem("checkoutItems", JSON.stringify(checkoutItem));
        window.location.href = "checkout.html";
    } else {
        Swal.fire({ icon: 'error', title: 'สินค้าหมด', background: '#1a1a1a', color: '#fff' });
    }
}

function addToCart(e, id) {
    e.stopPropagation();
    const products = JSON.parse(localStorage.getItem('sneaker_prods')) || [];
    const p = products.find(item => String(item.id) === String(id));
    
    if(!p || Number(p.stock) <= 0) return;

    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    let found = cart.find(item => String(item.id) === String(id));

    if(found) {
        found.qty += 1;
    } else {
        cart.push({
            id: p.id,
            name: p.name,
            price: p.price,
            size: p.sizes ? p.sizes.split(',')[0].trim() : 'N/A',
            img: (p.images && p.images.length > 0) ? p.images[0] : p.img,
            qty: 1
        });
    }

    localStorage.setItem("cart", JSON.stringify(cart));
    updateCartCount();
    Swal.fire({
        toast: true, position: 'top-end', icon: 'success',
        title: 'เพิ่มลงตะกร้าแล้ว', showConfirmButton: false, timer: 1500
    });
}

function updateCartCount() {
    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    let totalQty = cart.reduce((sum, item) => sum + Number(item.qty), 0);
    document.getElementById("cartCount").innerText = totalQty;
}

window.onload = () => {
    renderAllProducts();
    updateCartCount();
};
</script>

</body>
</html>
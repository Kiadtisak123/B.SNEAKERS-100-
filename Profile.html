<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>โปรไฟล์ | B.Sneakers</title>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">

<style>
  * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Kanit', sans-serif; }
  body { background: #0f0f0f; color: #fff; min-height: 100vh; }
  
  header {
    background: #111;
    padding: 15px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 2px solid #e60023;
    position: sticky; top: 0; z-index: 1000;
  }
  .logo { color: #e60023; font-size: 24px; font-weight: bold; letter-spacing: 1px; text-decoration: none; }
  .logo span { color: #fff; }

  .container { max-width: 600px; margin: 40px auto; padding: 0 20px; }
  .profile-box { 
    background: #1a1a1a; 
    border-radius: 24px; 
    padding: 40px; 
    border: 1px solid #333;
    box-shadow: 0 15px 35px rgba(0,0,0,0.6);
  }

  .avatar-section { text-align: center; margin-bottom: 35px; position: relative; }
  .avatar-wrapper { position: relative; display: inline-block; }
  .avatar-section img { 
    width: 140px; height: 140px; border-radius: 50%; 
    border: 4px solid #e60023; object-fit: cover; background: #222; padding: 3px;
  }
  #avatarInput { display: none; }
  .upload-label {
    position: absolute; bottom: 5px; right: 5px; background: #e60023;
    width: 38px; height: 38px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center; cursor: pointer;
    border: 3px solid #1a1a1a;
  }

  h2 { margin-bottom: 25px; text-align: center; font-weight: 600; font-size: 24px; }
  .input-group { margin-bottom: 20px; }
  label { display: block; margin-bottom: 8px; color: #888; font-size: 14px; }
  
  input, textarea {
    width: 100%; padding: 14px; border-radius: 12px; border: 1px solid #333;
    background: #0a0a0a; color: #fff; font-size: 16px; outline: none;
  }
  input:read-only { background: #111; color: #666; cursor: not-allowed; }

  .btn {
    width: 100%; background: #e60023; border: none; padding: 15px;
    border-radius: 12px; color: #fff; cursor: pointer; font-weight: 600;
    display: flex; align-items: center; justify-content: center; gap: 10px;
  }
  
  .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
  .btn-secondary { background: #2a2a2a; }
  .btn-logout { background: transparent; color: #ff4d4d; border: 1px solid rgba(255, 77, 77, 0.3); margin-top: 25px; }

  .actions { margin-top: 20px; border-top: 1px solid #333; padding-top: 25px; }
</style>
</head>

<body>

<header>
  <a href="index.html" class="logo">B.<span>SNEAKERS</span></a>
</header>

<div class="container">
  <div class="profile-box">
    <div class="avatar-section">
      <div class="avatar-wrapper">
        <img id="avatarImg" src="https://cdn-icons-png.flaticon.com/512/149/149071.png">
        <label for="avatarInput" class="upload-label">
          <i class="fa-solid fa-camera"></i>
        </label>
        <input type="file" id="avatarInput" accept="image/*">
      </div>
    </div>

    <h2>ข้อมูลส่วนตัว</h2>
    
    <div class="input-group">
      <label><i class="fa-solid fa-user"></i> ชื่อผู้ใช้</label>
      <input id="username" readonly placeholder="ไม่ได้เข้าสู่ระบบ">
    </div>
    
    <div class="input-group">
      <label><i class="fa-solid fa-envelope"></i> อีเมล</label>
      <input id="email" type="email" placeholder="example@email.com">
    </div>

    <div class="input-group">
      <label><i class="fa-solid fa-location-dot"></i> ที่อยู่จัดส่ง</label>
      <textarea id="address" rows="3" placeholder="เลขที่บ้าน, ถนน, ตำบล..."></textarea>
    </div>

    <button class="btn" onclick="saveProfile()">
      <i class="fa-solid fa-floppy-disk"></i> บันทึกข้อมูล
    </button>

    <div class="actions">
      <div class="btn-group">
        <button class="btn btn-secondary" onclick="location.href='index.html'">หน้าหลัก</button>
        <button class="btn btn-secondary" onclick="location.href='order-history.html'">ประวัติสั่งซื้อ</button>
      </div>
      <button class="btn btn-logout" onclick="logout()">ออกจากระบบ</button>
    </div>
  </div>
</div>

<script>
// ดึงข้อมูล User (ถ้าไม่มีให้สร้าง Object ว่างป้องกัน Error)
let currentUser = JSON.parse(localStorage.getItem("currentUser")) || { username: "Guest", email: "", address: "", avatar: "" };

// แสดงข้อมูล
document.getElementById("username").value = currentUser.username;
document.getElementById("email").value = currentUser.email || "";
document.getElementById("address").value = currentUser.address || "";
if(currentUser.avatar) document.getElementById("avatarImg").src = currentUser.avatar;

// อัปโหลดรูป (บีบอัดรูปให้เล็กลงอัตโนมัติ)
document.getElementById("avatarInput").addEventListener("change", function(e){
  const file = e.target.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = function(){
    const img = new Image();
    img.src = reader.result;
    img.onload = function() {
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      canvas.width = 150; canvas.height = 150; // บีบขนาดรูปโปรไฟล์
      ctx.drawImage(img, 0, 0, 150, 150);
      const base64Img = canvas.toDataURL('image/jpeg', 0.7);
      
      document.getElementById("avatarImg").src = base64Img;
      currentUser.avatar = base64Img;
      saveToStorage();
    };
  };
  reader.readAsDataURL(file);
});

function saveProfile(){
  currentUser.email = document.getElementById("email").value;
  currentUser.address = document.getElementById("address").value;
  saveToStorage();
  Swal.fire({ icon: 'success', title: 'บันทึกสำเร็จ', background: '#1a1a1a', color: '#fff' });
}

function saveToStorage() {
  localStorage.setItem("currentUser", JSON.stringify(currentUser));
  // อัปเดตในฐานข้อมูลรวม
  let users = JSON.parse(localStorage.getItem("users")) || [];
  const idx = users.findIndex(u => u.username === currentUser.username);
  if(idx !== -1) {
    users[idx] = currentUser;
    localStorage.setItem("users", JSON.stringify(users));
  }
}

function logout(){
  localStorage.removeItem("currentUser");
  window.location.href = "login.html";
}
</script>
</body>
</html>

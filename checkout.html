<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô | B.Sneakers</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
  /* --- Style ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÑ‡∏ß‡πâ ‡∏Ñ‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏° --- */
  body { background:#0f0f0f; color:#fff; font-family:'Kanit', sans-serif; margin:0; padding-bottom: 50px; }
  .container { max-width: 650px; margin: 40px auto; padding: 0 20px; }
  .card { background:#1a1a1a; padding:30px; border-radius:24px; border:1px solid #222; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
  h1 { font-size: 28px; margin-bottom: 25px; display: flex; align-items: center; gap: 10px; color: #e60023; }
  
  .input-group { margin-bottom: 15px; text-align: left; }
  label { display: block; margin-bottom: 8px; font-size: 14px; color: #888; }
  input, textarea, select { width: 100%; padding: 12px 15px; background: #0f0f0f; border: 1px solid #333; border-radius: 12px; color: #fff; font-size: 15px; transition: 0.3s; }
  input:focus, textarea:focus, select:focus { outline: none; border-color: #e60023; background: #151515; }
  
  .order-summary { background: #222; padding: 15px; border-radius: 15px; margin-bottom: 20px; text-align: left; }
  .item-row { display: flex; justify-content: space-between; font-size: 14px; margin-bottom: 8px; color: #bbb; }
  
  .total { font-size: 24px; color: #ffd700; margin: 20px 0; font-weight: bold; border-top: 1px dashed #444; padding-top: 15px; text-align: right; }
  
  #qrBox { background: #fff; color: #000; padding: 25px; border-radius: 20px; margin: 20px 0; display: none; text-align: center; }
  .qr { width: 100%; max-width: 250px; border-radius: 10px; margin: 0 auto 15px; display: block; border: 1px solid #eee; }
  
  .bank-info { font-weight: bold; font-size: 16px; margin: 5px 0; color: #333; }
  .notice { color: #e60023; font-size: 14px; margin-top: 10px; font-weight: bold; }
  
  .btn { background: #e60023; border: none; padding: 16px; color: #fff; border-radius: 15px; cursor: pointer; font-size: 18px; width: 100%; font-weight: bold; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px; }
  .btn:hover { background: #ff1a3d; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(230,0,35,0.3); }
  
  .back-link { display: block; margin-top: 20px; color: #666; text-decoration: none; font-size: 14px; text-align: center; }
  .back-link:hover { color: #fff; }
</style>
</head>

<body>

<div class="container">
  <div class="card">
    <h1><i class="fa-solid fa-credit-card"></i> ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h1>

    <div class="order-summary" id="orderItems"></div>

    <div class="input-group">
      <label><i class="fa-solid fa-user"></i> ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö</label>
      <input type="text" id="customerName" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
    </div>

    <div class="input-group">
      <label><i class="fa-solid fa-phone"></i> ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
      <input type="tel" id="customerTel" placeholder="08X-XXXXXXX">
    </div>

    <div class="input-group">
      <label><i class="fa-solid fa-location-dot"></i> ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</label>
      <textarea id="address" rows="3" placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà, ‡∏ñ‡∏ô‡∏ô, ‡∏ï‡∏≥‡∏ö‡∏•, ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠, ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î, ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå"></textarea>
    </div>

    <div class="input-group">
      <label><i class="fa-solid fa-truck"></i> ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</label>
      <select id="paymentMethod" onchange="updateTotal(); toggleQR()">
        <option value="transfer">‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ü‡∏£‡∏µ‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°)</option>
        <option value="cod">‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á (+200 ‡∏ö‡∏≤‡∏ó)</option>
      </select>
    </div>

    <div id="qrBox">
      <img src="b7bbaa1f-c5b5-45b2-b3d9-d1b276d1c1e2.jpg" class="qr" alt="PromptPay QR">
      <div class="bank-info">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå: 080-625-6731</div>
      <div class="bank-info">‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢: 252-0-64761-2</div>
      <div class="bank-info">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: ‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡πÄ‡∏Å‡∏ï‡∏∏‡∏™‡∏£‡πâ‡∏≠‡∏¢</div>
      <div class="notice">üìå ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡πÉ‡∏ô‡πÅ‡∏ä‡∏ó‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö</div>
    </div>

    <div class="total">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: <span id="finalTotal">0</span> ‡∏ø</div>

    <button class="btn" onclick="confirmOrder()">
      <i class="fa-solid fa-shield-check"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
    </button>

    <a href="‡∏ï‡∏£‡∏∞‡∏Å‡∏£‡πâ‡∏≤.html" class="back-link">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</a>
  </div>
</div>

<script>
const SHIPPING = 100;
const COD_EXTRA = 200;

// ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
let fullCart = JSON.parse(localStorage.getItem("cart")) || [];
let cart = fullCart.filter(item => item.selected !== false);

// ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πâ‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
if (cart.length === 0) {
    Swal.fire({
        title: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤',
        text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô',
        icon: 'warning',
        confirmButtonColor: '#e60023'
    }).then(() => {
        window.location.href = 'product.html';
    });
}

function renderSummary() {
  const container = document.getElementById("orderItems");
  let html = "";
  cart.forEach(item => {
    html += `<div class="item-row">
                <span>${item.name} (x${item.qty})</span>
                <span>‡∏ø${(item.price * item.qty).toLocaleString()}</span>
              </div>`;
  });
  html += `<div class="item-row" style="color:#e60023; border-top: 1px solid #333; padding-top: 10px; margin-top: 10px;">
              <span>‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</span>
              <span>‡∏ø${SHIPPING}</span>
            </div>`;
  container.innerHTML = html;
}

function updateTotal(){
  let baseTotal = 0;
  cart.forEach(item => baseTotal += item.price * item.qty);
  const method = document.getElementById("paymentMethod").value;
  let total = baseTotal + SHIPPING;
  if(method === "cod") total += COD_EXTRA;
  document.getElementById("finalTotal").innerText = total.toLocaleString();
}

function toggleQR(){
  const method = document.getElementById("paymentMethod").value;
  document.getElementById("qrBox").style.display = (method === "transfer") ? "block" : "none";
}

function confirmOrder(){
  const name = document.getElementById("customerName").value.trim();
  const tel = document.getElementById("customerTel").value.trim();
  const address = document.getElementById("address").value.trim();
  const method = document.getElementById("paymentMethod").value;
  const totalText = document.getElementById("finalTotal").innerText;
  const currentUserRaw = localStorage.getItem("currentUser");

  if(!name || !address || !tel){
    Swal.fire('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠ ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ ‡πÅ‡∏•‡∏∞‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á', 'error');
    return;
  }
  
  const orderID = "BSN-" + Math.floor(Math.random() * 1000000);

  Swal.fire({
    title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠?',
    text: "‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÅ‡∏ä‡∏ó Messenger ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô",
    icon: 'question',
    showCancelButton: true,
    confirmButtonColor: '#e60023',
    confirmButtonText: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠',
    cancelButtonText: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
    background: '#1a1a1a',
    color: '#fff'
  }).then((result) => {
    if (result.isConfirmed) {
      
      // 1. ‡∏ï‡∏±‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
      let products = JSON.parse(localStorage.getItem("sneaker_prods")) || [];
      cart.forEach(cartItem => {
          let pIndex = products.findIndex(p => String(p.id) === String(cartItem.id));
          if(pIndex !== -1) {
              products[pIndex].stock = Math.max(0, products[pIndex].stock - cartItem.qty);
          }
      });
      localStorage.setItem("sneaker_prods", JSON.stringify(products));

      // 2. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
      let orders = JSON.parse(localStorage.getItem("orders")) || [];
      const orderData = {
        orderID,
        user: currentUserRaw ? JSON.parse(currentUserRaw).username : "Guest",
        date: new Date().toLocaleString(),
        name, tel, address, method, 
        items: cart,
        total: parseInt(totalText.replace(/,/g,"")),
        status: 'pending',
        isRead: false
      };
      orders.push(orderData);
      localStorage.setItem("orders", JSON.stringify(orders));

      // 3. ‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
      const remainingCart = fullCart.filter(item => item.selected === false);
      localStorage.setItem("cart", JSON.stringify(remainingCart));

      // 4. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡πà‡∏á Messenger
      let itemsText = "";
      cart.forEach(item => itemsText += `- ${item.name} (‡πÑ‡∏ã‡∏™‡πå ${item.size || 'N/A'}) x${item.qty}\n`);
      
      const message = `üõçÔ∏è **‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏°‡πà: ${orderID}**\n\n` +
                      `üë§ ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö: ${name}\n` +
                      `üìû ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: ${tel}\n` +
                      `üìç ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: ${address}\n` +
                      `üì¶ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: \n${itemsText}\n` +
                      `üí≥ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞: ${method === 'transfer' ? '‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå/‡∏Å‡∏™‡∏¥‡∏Å‡∏£)' : '‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á'}\n` +
                      `üí∞ ‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${totalText} ‡∏ö‡∏≤‡∏ó\n\n` +
                      (method === 'transfer' ? '‚ö†Ô∏è ‡∏£‡∏ö‡∏Å‡∏ß‡∏ô‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô' : '‚úÖ ‡∏£‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á');

      const fbPageID = "102799091274255"; 
      // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ Messenger ‡∏Ç‡∏≠‡∏á‡πÄ‡∏û‡∏à
      window.location.href = `https://m.me/${fbPageID}?text=${encodeURIComponent(message)}`;
    }
  });
}

// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
renderSummary();
updateTotal();
toggleQR();
</script>

</body>
</html>
<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>โปรไฟล์ | B.Sneakers</title>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

<style>
  * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
  body { background: #0f0f0f; color: #fff; min-height: 100vh; }
  
  header {
    background: #111;
    padding: 15px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 2px solid #e60023;
  }
  .logo { color: #e60023; font-size: 24px; font-weight: bold; letter-spacing: 1px; }

  .container { max-width: 600px; margin: 40px auto; padding: 20px; }
  .profile-box { 
    background: #1a1a1a; 
    border-radius: 20px; 
    padding: 40px; 
    border: 1px solid #333;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
  }

  .avatar-section { text-align: center; margin-bottom: 30px; position: relative; }
  .avatar-wrapper {
    position: relative;
    display: inline-block;
  }
  .avatar-section img { 
    width: 140px; 
    height: 140px; 
    border-radius: 50%; 
    border: 4px solid #e60023; 
    object-fit: cover;
    background: #333;
  }
  #avatarInput { display: none; }
  .upload-label {
    position: absolute;
    bottom: 5px;
    right: 5px;
    background: #e60023;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: 0.3s;
  }
  .upload-label:hover { transform: scale(1.1); background: #ff1a3d; }

  h2 { margin-bottom: 20px; text-align: center; font-weight: 500; }
  
  .input-group { margin-bottom: 15px; }
  label { display: block; margin-bottom: 5px; color: #888; font-size: 14px; }
  
  input, textarea {
    width: 100%; padding: 12px; 
    border-radius: 12px; border: 1px solid #333;
    background: #0a0a0a; color: #fff; font-size: 16px;
    transition: 0.3s; outline: none;
  }
  input:focus, textarea:focus { border-color: #e60023; }

  .btn {
    width: 100%;
    background: #e60023; border: none; padding: 14px;
    border-radius: 12px; color: #fff; cursor: pointer;
    font-weight: bold; font-size: 16px; transition: 0.3s;
    display: flex; align-items: center; justify-content: center; gap: 8px;
  }
  .btn:hover { background: #ff1a3d; transform: translateY(-2px); }
  .btn-secondary { background: #333; margin-top: 10px; }
  .btn-secondary:hover { background: #444; }
  .btn-logout { background: transparent; color: #e60023; border: 1px solid #e60023; margin-top: 20px; }
  .btn-logout:hover { background: rgba(230, 0, 35, 0.1); }

  .actions { margin-top: 25px; }
</style>
</head>

<body>

<header>
  <div class="logo">B.SNEAKERS</div>
</header>

<div class="container">
  <div class="profile-box">
    <div class="avatar-section">
      <div class="avatar-wrapper">
        <img id="avatarImg" src="https://cdn-icons-png.flaticon.com/512/149/149071.png">
        <label for="avatarInput" class="upload-label">
          <i class="fa-solid fa-camera"></i>
        </label>
        <input type="file" id="avatarInput" accept="image/*">
      </div>
    </div>

    <h2>ข้อมูลโปรไฟล์</h2>
    
    <div class="input-group">
      <label>ชื่อผู้ใช้ (Username)</label>
      <input id="username" readonly style="color: #666; cursor: not-allowed;">
    </div>
    
    <div class="input-group">
      <label>อีเมล (Email)</label>
      <input id="email" type="email">
    </div>

    <div class="input-group">
      <label>ที่อยู่จัดส่ง</label>
      <textarea id="address" rows="3" placeholder="ระบุบ้านเลขที่ ถนน แขวง/ตำบล..."></textarea>
    </div>

    <button class="btn" onclick="saveProfile()">
      <i class="fa-solid fa-floppy-disk"></i> บันทึกข้อมูล
    </button>

    <div class="actions">
      <button class="btn btn-secondary" onclick="location.href='homepage.html'">
        <i class="fa-solid fa-house"></i> กลับหน้าแรก
      </button>
      <button class="btn btn-secondary" onclick="location.href='orders.html'">
        <i class="fa-solid fa-box-open"></i> ประวัติคำสั่งซื้อ
      </button>
      <button class="btn btn-logout" onclick="logout()">
        <i class="fa-solid fa-right-from-bracket"></i> ออกจากระบบ
      </button>
    </div>
  </div>
</div>

<script>
// ดึงข้อมูล User ปัจจุบัน
let currentUser = JSON.parse(localStorage.getItem("currentUser"));

if(!currentUser){
  window.location.href = "login.html";
}

// แสดงข้อมูลใน Input
document.getElementById("username").value = currentUser.username || "";
document.getElementById("email").value = currentUser.email || "";
document.getElementById("address").value = currentUser.address || "";
if(currentUser.avatar) {
  document.getElementById("avatarImg").src = currentUser.avatar;
}

// ฟังก์ชันอัปโหลดรูปภาพ
document.getElementById("avatarInput").addEventListener("change", function(e){
  const file = e.target.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = function(){
    const base64Img = reader.result;
    document.getElementById("avatarImg").src = base64Img;
    
    // อัปเดตรูปใน currentUser
    currentUser.avatar = base64Img;
    saveToStorage();
  };
  reader.readAsDataURL(file);
});

// บันทึกข้อมูล
function saveProfile(){
  currentUser.email = document.getElementById("email").value.trim();
  currentUser.address = document.getElementById("address").value.trim();
  
  saveToStorage();
  
  Swal.fire({
    icon: 'success',
    title: 'สำเร็จ',
    text: 'บันทึกข้อมูลเรียบร้อยแล้ว',
    confirmButtonColor: '#e60023'
  });
}

function saveToStorage() {
  // 1. อัปเดต currentUser (คนที่ Login อยู่)
  localStorage.setItem("currentUser", JSON.stringify(currentUser));
  
  // 2. อัปเดตใน users (ฐานข้อมูลหลัก) เพื่อให้ข้อมูลคงอยู่ถาวร
  let users = JSON.parse(localStorage.getItem("users")) || [];
  users = users.map(u => {
    if(u.username === currentUser.username) {
      return { ...u, email: currentUser.email, address: currentUser.address, avatar: currentUser.avatar };
    }
    return u;
  });
  localStorage.setItem("users", JSON.stringify(users));
}

function logout(){
  Swal.fire({
    title: 'ต้องการออกจากระบบ?',
    icon: 'question',
    showCancelButton: true,
    confirmButtonColor: '#e60023',
    cancelButtonColor: '#333',
    confirmButtonText: 'ใช่, ออกจากระบบ',
    cancelButtonText: 'ยกเลิก'
  }).then((result) => {
    if (result.isConfirmed) {
      localStorage.removeItem("currentUser");
      window.location.href = "login.html";
    }
  });
}
</script>

</body>
</html>
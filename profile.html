<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>โปรไฟล์ | B.Sneakers</title>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
<style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Kanit', sans-serif}
    body{background:#0f0f0f;color:#fff;padding:20px;}
    .profile-box{max-width:500px;margin:40px auto;background:#1a1a1a;padding:30px;border-radius:20px;border:1px solid #333;text-align:center;}
    .avatar-wrapper{position:relative;display:inline-block;margin-bottom:20px;}
    .avatar-wrapper img{width:120px;height:120px;border-radius:50%;border:3px solid #e60023;object-fit:cover;}
    .upload-btn{position:absolute;bottom:5px;right:5px;background:#e60023;width:35px;height:35px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;}
    input, textarea{width:100%;padding:12px;margin:10px 0;background:#000;border:1px solid #333;color:#fff;border-radius:10px;}
    .btn{width:100%;padding:12px;background:#e60023;border:none;color:#fff;border-radius:10px;cursor:pointer;font-weight:600;margin-top:10px;}
    .btn-group{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:20px;}
    .btn-sec{background:#333;}
</style>
</head>
<body>
<div class="profile-box">
    <div class="avatar-wrapper">
        <img id="avatarImg" src="https://cdn-icons-png.flaticon.com/512/149/149071.png">
        <label for="avatarInput" class="upload-btn"><i class="fa-solid fa-camera"></i></label>
        <input type="file" id="avatarInput" style="display:none" accept="image/*">
    </div>
    <h2>ข้อมูลส่วนตัว</h2>
    <input id="username" readonly style="color:#666">
    <input id="email" type="email" placeholder="อีเมล">
    <textarea id="address" rows="3" placeholder="ที่อยู่สำหรับการจัดส่ง"></textarea>
    <button class="btn" onclick="saveProfile()">บันทึกข้อมูล</button>
    
    <div class="btn-group">
        <button class="btn btn-sec" onclick="location.href='./index.html'">หน้าหลัก</button>
        <button class="btn btn-sec" onclick="location.href='./orders.html'">ประวัติสั่งซื้อ</button>
    </div>
    <button class="btn btn-sec" onclick="logout()" style="color:#ff4d4d">ออกจากระบบ</button>
</div>
<script>
    let user = JSON.parse(localStorage.getItem("currentUser"));
    if(!user) window.location.href = "./login.html";

    document.getElementById("username").value = user.username;
    document.getElementById("email").value = user.email || "";
    document.getElementById("address").value = user.address || "";
    if(user.avatar) document.getElementById("avatarImg").src = user.avatar;

    document.getElementById("avatarInput").onchange = (e) => {
        const reader = new FileReader();
        reader.onload = () => {
            document.getElementById("avatarImg").src = reader.result;
            user.avatar = reader.result;
        };
        reader.readAsDataURL(e.target.files[0]);
    };

    function saveProfile() {
        user.email = document.getElementById("email").value;
        user.address = document.getElementById("address").value;
        localStorage.setItem("currentUser", JSON.stringify(user));
        
        // อัปเดตในฐานข้อมูลผู้ใช้ทั้งหมดด้วย
        let allUsers = JSON.parse(localStorage.getItem("users")) || [];
        allUsers = allUsers.map(u => u.username === user.username ? user : u);
        localStorage.setItem("users", JSON.stringify(allUsers));
        
        Swal.fire('สำเร็จ', 'บันทึกข้อมูลแล้ว', 'success');
    }

    function logout() {
        localStorage.removeItem("currentUser");
        window.location.href = "./index.html";
    }
</script>
</body>
</html>
